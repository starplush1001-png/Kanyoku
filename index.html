<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>慣用句学習アプリ</title>

<style>
body {
  font-family: sans-serif;
  margin: 20px;
  font-size: 1.3em;
}

#controls {
  text-align: center;
  margin-bottom: 20px;
}

button {
  font-size: 1.3em;
  padding: 10px 14px;
  margin: 5px;
}

.phrase {
  border: 2px solid #444;
  padding: 20px;
  margin: 10px auto;
  width: 50%;
  cursor: pointer;
  text-align: left;
}

.front { font-weight: bold; }
.back  { font-weight: bold; }

.red { color: red; }
.black { color: black; }

#note {
  margin-top: 30px;
  font-size: 0.9em;
  border-top: 1px dashed #999;
  padding-top: 10px;
  color: #555;
}
</style>
</head>

<body>

<h1 style="text-align:center;">慣用句学習アプリ</h1>

<div id="controls">
  <label><input type="checkbox" id="toggleFront"> 前半を隠す</label>
  <label><input type="checkbox" id="randomOrder"> ランダム出題</label>
  <label><input type="checkbox" id="weakMode"> 苦手問題優先</label>
</div>

<div id="questions"></div>

<div style="text-align:center;">
  <button id="showAnswerBtn">答えを見る</button>
  <button id="nextBtn">次の5問</button>
</div>

<div id="note">
<strong>注釈</strong><br>
・問題を1回クリック → 答えを表示<br>
・もう1回クリック → 不正解として記憶<br>
・不正解が多い問題は「苦手問題優先」で出やすくなります
</div>

<script>
const phrases = [
  ["猫に","小判"],
  ["二兎をおう者は","一兎をも得ず"],
  ["逃がした魚は","大きい"],
  ["灯台もと","暗し"],
  ["善は","急げ"],
  ["石橋を","たたいて渡る"],
  ["三度目の","正直"],
  ["七転び","八起き"],
  ["急がば","回れ"],
  ["論より","証拠"],
  ["類は","友を呼ぶ"],
  ["良薬は","口ににがし"],
  ["立て板に","水"],
  ["餅は","餅屋"],
  ["壁に","耳あり"],
  ["百聞は","一見にしかず"],
  ["備えあれば","憂いなし"],
  ["飛ぶ鳥","後をにごさず"],
  ["背に腹は","かえられぬ"],
  ["馬の耳に","念仏"]
];

const questionsDiv = document.getElementById("questions");
const toggleFront = document.getElementById("toggleFront");
const randomOrder = document.getElementById("randomOrder");
const weakMode = document.getElementById("weakMode");
const showAnswerBtn = document.getElementById("showAnswerBtn");
const nextBtn = document.getElementById("nextBtn");

const questionsPerPage = 5;
let order = [];
let index = 0;
let mistakes = {};

function makeOrder(){
  if(weakMode.checked){
    order = phrases.map((_,i)=>({i, m:mistakes[i]||0}))
                   .sort((a,b)=>b.m-a.m)
                   .map(o=>o.i);
  } else {
    order = phrases.map((_,i)=>i);
    if(randomOrder.checked) order.sort(()=>Math.random()-0.5);
  }
}

function draw(){
  makeOrder();
  questionsDiv.innerHTML = "";

  const hideFront = toggleFront.checked;

  for(let i=0;i<questionsPerPage;i++){
    let q = order[index+i];
    if(q===undefined){ index=0; q=order[i]; }
    const [front, back] = phrases[q];

    const div = document.createElement("div");
    div.className = "phrase";
    div.dataset.state = "hidden";
    div.dataset.q = q;

    const count = mistakes[q]||0;
    const countText = count>0 ? `[${count}] ` : "";

    const frontSpan = `<span class="front ${hideFront?'':'black'}" style="visibility:${hideFront?'hidden':'visible'}">${front}</span>`;
    const backSpan  = `<span class="back black" style="visibility:${hideFront?'visible':'hidden'}">${back}</span>`;

    div.innerHTML = countText + frontSpan + " " + backSpan;

    div.onclick = ()=>{
      const f = div.querySelector(".front");
      const b = div.querySelector(".back");

      if(div.dataset.state==="hidden"){
        if(hideFront){
          f.style.visibility="visible";
          f.className="front red";
          b.className="back black";
        }else{
          b.style.visibility="visible";
          b.className="back red";
          f.className="front black";
        }
        div.dataset.state="shown";
      }
      else if(div.dataset.state==="shown"){
        mistakes[q]=(mistakes[q]||0)+1;
        div.innerHTML = `[${mistakes[q]}] <span class="front red">${front}</span> <span class="back red">${back}</span>`;
        div.dataset.state="counted";
      }
    };

    questionsDiv.appendChild(div);
  }
}

showAnswerBtn.onclick = ()=>{
  document.querySelectorAll(".phrase").forEach(div=>{
    div.click();
  });
};

nextBtn.onclick = ()=>{
  index += questionsPerPage;
  if(index>=phrases.length) index=0;
  draw();
};

toggleFront.onchange = ()=>{ index=0; draw(); };
randomOrder.onchange = ()=>{ index=0; draw(); };
weakMode.onchange = ()=>{ index=0; draw(); };

draw();
</script>

</body>
</html>
