<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>慣用句学習アプリ</title>
<style>
body { font-family: sans-serif; margin: 20px; }
#controls { margin-bottom: 20px; text-align: center; }
button { margin: 5px; font-size: 18px; padding: 8px 12px; }

.phrase { 
  border: 2px solid #444; 
  padding: 20px; 
  margin: 10px auto; 
  width: 50%; /* 横幅50% */
  font-size: 26px; /* 文字大きめ */
  cursor: pointer; 
  display: block; /* 縦に並べる */
  text-align: left; /* 左詰め */
}

.front { font-weight: bold; }
.back { margin-left: 5px; }
</style>
</head>
<body>

<h1 style="text-align:center;">慣用句学習アプリ</h1>

<div id="controls">
  <label><input type="checkbox" id="toggleFront"> 前半を隠す</label>
  <label><input type="checkbox" id="randomOrder"> ランダム出題</label>
  <label><input type="checkbox" id="weakMode"> 苦手問題優先</label>
  <br>
  <label>プレーヤー:</label>
  <label><input type="checkbox" class="player" value="ミナト"> ミナト</label>
  <label><input type="checkbox" class="player" value="ソウワ"> ソウワ</label>
  <label><input type="checkbox" class="player" value="ヒロ"> ヒロ</label>
  <label><input type="checkbox" class="player" value="トモ"> トモ</label>
</div>

<div id="questions"></div>

<div style="text-align:center;">
  <button id="showAnswerBtn">答えを見る</button>
  <button id="nextBtn">次の5問</button>
</div>

<script>
// 100個の慣用句（略）
// 前回のコードの phrases 配列をここに入れる

const phrases = [
  ["論より","証拠"], ["類は","友を呼ぶ"], ["良薬は","口ににがし"], ["立て板に","水"], ["揚げ足を","とる"],
  ["柳の下の","どじょう"], ["餅は","餅屋"], ["坊主にくけりゃ","袈裟までにくい"], ["壁に","耳あり"], ["聞くは一時の恥","聞かぬは一生の恥"],
  ["聞いて","極楽 見て","地獄"], ["武士はくわねど","高楊枝"], ["負けるが","勝ち"], ["腐っても","鯛"], ["百聞は","一見にしかず"],
  ["備えあれば","うれいなし"], ["飛んで火にいる","夏の虫"], ["飛ぶ鳥","後をにごさず"], ["背に腹は","かえらぬ"], ["馬の耳に","念仏"],
  ["能ある鷹は","つめを隠す"], ["猫に","小判"], ["二兎をおう者は","一兎をも得ず"], ["鳶に","油揚げをさらわれる"], ["毒を食わば","皿まで"],
  ["毒をもって","毒を制す"], ["頭かくして","尻かくさず"], ["逃がした魚は","大きい"], ["灯台もと","暗し"], ["盗人を見て","なわをなう"],
  ["渡る世間に","鬼はなし"], ["転ばぬ先の","杖"], ["天に","つばする"], ["笛ふけど","おどらず"], ["敵も","さるもの"],
  ["鶴の","一声"], ["爪に","火をともす"], ["長い物には","巻かれろ"], ["竹馬の","友"], ["地獄で","仏"],
  ["知らぬが","仏"], ["短気は","損気"], ["大事の前の","小事"], ["大山鳴動して","ねずみ一匹"], ["待てば海路の","ひよりあり"],
  ["帯に短したすきに","長し"], ["対岸の","火事"], ["足もとから","鳥が立つ"], ["憎まれっ子","世にはばかる"], ["善は","急げ"],
  ["赤子の手を","ひねる"], ["石橋を","たたいて渡る"], ["石の上にも","三年"], ["生き馬の目を","抜く"], ["雀百まで","おどりを忘れず"],
  ["人のふり見て","我がふり直せ"], ["身から","出たさび"], ["親の心","子知らず"], ["親のすねを","かじる"], ["心を","鬼にする"],
  ["寝耳に","水"], ["尻切れ","トンボ"], ["触らぬ神に","たたりなし"], ["乗りかかった","船"], ["焼け石に","水"],
  ["勝ってかぶとの緒を","しめよ"], ["所変われば","品変わる"], ["出る杭は","打たれる"], ["十人十色"], ["住めば","都"],
  ["朱に交われば","赤くなる"], ["手塩に","かける"], ["手の裏を","かえす"], ["蛇の道は","へび"], ["七転び","八起き"],
  ["時は","金なり"], ["歯に衣","着せぬ"], ["飼い犬に","手をかまれる"], ["三度目の","正直"], ["三人よれば","文殊のちえ"],
  ["三つ子の魂","百まで"], ["高みの","見物"], ["弘法にも","筆のあやまり"], ["好きこそ物の","上手なれ"], ["口は災いの","もと"],
  ["光陰矢の","ごとし"], ["鯉の","たき登り"], ["虎の","子"], ["枯れ木も山の","にぎわい"], ["故郷に","錦をかざる"],
  ["犬も歩けば","棒にあたる"], ["月と","すっぽん"], ["君子あやうきに","近寄らず"], ["苦しいときの","神だのみ"], ["苦は楽の","種"],
  ["郷に入っては","郷に従え"], ["魚心あれば","水心"], ["窮鼠","猫をかむ"], ["窮すれば","通ず"], ["泣き面には","ち"],
  ["急がば","回れ"], ["急いては","事をし損じる"], ["鬼の目にも","なみだ"], ["鬼の居ぬ間に","洗濯"], ["鬼に","金棒"],
  ["顔に","どろをぬる"], ["蛙の面に","水"], ["花より","団子"], ["火中の栗を","ひろう"], ["河童の","川流れ"],
  ["果報は","ねて待て"], ["化けの皮を","あらわす"], ["下手の考え","休むににたり"], ["恩をあだで","かえす"], ["縁の下の","力持ち"],
  ["猿も木から","落ちる"], ["雨降って","地固まる"]
];

const questionsDiv = document.getElementById("questions");
const showAnswerBtn = document.getElementById("showAnswerBtn");
const nextBtn = document.getElementById("nextBtn");
const toggleFront = document.getElementById("toggleFront");
const randomOrderCheckbox = document.getElementById("randomOrder");
const weakModeCheckbox = document.getElementById("weakMode");
const playerCheckboxes = document.querySelectorAll(".player");

const players = Array.from(playerCheckboxes).map(c=>c.value);
let playerHistory = {};
players.forEach(p => { playerHistory[p] = {}; });

let currentOrder = [];
let currentIndex = 0;
const questionsPerPage = 5;

function getSelectedPlayers(){
  return Array.from(playerCheckboxes).filter(c=>c.checked).map(c=>c.value);
}

function prepareQuestionOrder(){
  if(weakModeCheckbox.checked){
    let totalWrongList = phrases.map((_,idx)=>{
      let total=0;
      Object.keys(playerHistory).forEach(p=>{
        total += playerHistory[p][idx]||0;
      });
      return {idx,total};
    });
    totalWrongList.sort((a,b)=>b.total - a.total);
    currentOrder = totalWrongList.map(o=>o.idx);
  } else {
    currentOrder = phrases.map((_,i)=>i);
    if(randomOrderCheckbox.checked) currentOrder.sort(()=>Math.random()-0.5);
  }
}

function updateFrontVisibility(){
  const hideFront = toggleFront.checked;
  document.querySelectorAll(".phrase").forEach(div=>{
    const frontSpan = div.querySelector(".front");
    frontSpan.style.visibility = hideFront ? "hidden" : "visible";
    div.querySelector(".back").style.visibility = hideFront ? "visible" : "hidden";
  });
}

function markWrong(div){
  const idx = div.dataset.idx;
  const selPlayers = getSelectedPlayers();
  selPlayers.forEach(p=>{
    playerHistory[p][idx] = (playerHistory[p][idx]||0) + 1;
  });
  displayQuestions();
}

function displayQuestions(){
  prepareQuestionOrder();
  questionsDiv.innerHTML="";
  const selPlayers = getSelectedPlayers();
  for(let i=0;i<questionsPerPage;i++){
    let idx = currentOrder[currentIndex+i];
    if(idx===undefined){
      currentIndex=0;
      idx = currentOrder[currentIndex+i];
      if(idx===undefined) break;
    }
    const [front,back] = phrases[idx];
    const div = document.createElement("div");
    div.classList.add("phrase");
    div.dataset.idx = idx;

    let countText = selPlayers.map(p=>`${playerHistory[p][idx]||0}`).join(" ");
    if(countText) countText = `[${countText}] `;

    div.innerHTML = `${countText}<span class="front">${front}</span> <span class="back">${back||""}</span>`;
    div.addEventListener("click", ()=> { markWrong(div); });
    questionsDiv.appendChild(div);
  }
  updateFrontVisibility();
  showAnswerBtn.disabled=false;
}

showAnswerBtn.addEventListener("click", ()=>{
  document.querySelectorAll(".phrase .back").forEach(span=>{
    span.style.visibility = "visible";
  });
});

nextBtn.addEventListener("click", ()=>{
  currentIndex += questionsPerPage;
  displayQuestions();
});

toggleFront.addEventListener("change", updateFrontVisibility);
randomOrderCheckbox.addEventListener("change", ()=>{ currentIndex=0; displayQuestions(); });
weakModeCheckbox.addEventListener("change", ()=>{ currentIndex=0; displayQuestions(); });
playerCheckboxes.forEach(c=>c.addEventListener("change", ()=>{ displayQuestions(); }));

displayQuestions();
</script>
</body>
</html>
