<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>慣用句学習アプリ（初級20問）</title>
<style>
  body { font-family: sans-serif; margin: 20px; font-size: 1.3em; }
  #controls { margin-bottom: 20px; text-align: center; }
  button { margin: 5px; font-size: 1.3em; padding: 10px 14px; }

  .phrase { 
    border: 2px solid #444; 
    padding: 20px; 
    margin: 10px auto; 
    width: 50%; /* 横幅50% */
    font-size: 1.3em; /* 文字サイズ1.3倍 */
    cursor: pointer; 
    display: block; /* 縦に並べる */
    text-align: left; /* 左詰め */
  }

  .front { font-weight: bold; }
  .back { margin-left: 5px; font-weight: bold; text-transform: uppercase; }
</style>
</head>
<body>

<h1 style="text-align:center;">慣用句学習アプリ（初級）</h1>

<div id="controls">
  <label><input type="checkbox" id="toggleFront"> 前半を隠す</label>
  <label><input type="checkbox" id="randomOrder"> ランダム出題</label>
  <label><input type="checkbox" id="weakMode"> 苦手問題優先</label>
</div>

<div id="questions"></div>

<div style="text-align:center;">
  <button id="showAnswerBtn">答えを見る</button>
  <button id="nextBtn">次の5問</button>
</div>

<script>
// 小学二年生以下向けの慣用句20問（指定の順序）
const phrases = [
  ["猫に","小判"],
  ["二兎をおう者は","一兎をも得ず"],
  ["逃がした魚は","大きい"],
  ["灯台もと","暗し"],
  ["善は","急げ"],
  ["石橋を","たたいて渡る"],
  ["三度目の","正直"],
  ["七転び","八起き"],
  ["急がば","回れ"],
  ["論より","証拠"],
  ["類は","友を呼ぶ"],
  ["良薬は","口ににがし"],
  ["立て板に","水"],
  ["餅は","餅屋"],
  ["壁に","耳あり"],
  ["百聞は","一見にしかず"],
  ["備えあれば","うれいなし"],
  ["飛ぶ鳥","後をにごさず"],
  ["背に腹は","かえられぬ"],
  ["馬の耳に","念仏"],
];

const questionsDiv = document.getElementById("questions");
const showAnswerBtn = document.getElementById("showAnswerBtn");
const nextBtn = document.getElementById("nextBtn");
const toggleFront = document.getElementById("toggleFront");
const randomOrderCheckbox = document.getElementById("randomOrder");
const weakModeCheckbox = document.getElementById("weakMode");

const questionsPerPage = 5;

let currentOrder = [];
let currentIndex = 0;

const player = "default"; // 1プレーヤー固定

// 間違えた回数管理（プレーヤー1人なので単純にインデックスごとに管理）
let mistakeCounts = {};

function prepareQuestionOrder(){
  if(weakModeCheckbox.checked){
    // 間違え多い順にソート
    let totalWrongList = phrases.map((_,idx)=>{
      return {idx, total: mistakeCounts[idx] || 0};
    });
    totalWrongList.sort((a,b)=>b.total - a.total);
    currentOrder = totalWrongList.map(o=>o.idx);
  } else {
    currentOrder = phrases.map((_,i)=>i);
    if(randomOrderCheckbox.checked){
      currentOrder.sort(()=>Math.random()-0.5);
    }
  }
}

function updateFrontVisibility(){
  const hideFront = toggleFront.checked;
  document.querySelectorAll(".phrase").forEach(div=>{
    const frontSpan = div.querySelector(".front");
    frontSpan.style.visibility = hideFront ? "hidden" : "visible";
    if(div.dataset.state==="hidden") div.querySelector(".back").style.visibility = hideFront ? "visible" : "hidden";
  });
}

function displayQuestions(){
  prepareQuestionOrder();
  questionsDiv.innerHTML="";

  for(let i=0; i<questionsPerPage; i++){
    let idx = currentOrder[currentIndex+i];
    if(idx === undefined){
      currentIndex = 0;
      idx = currentOrder[currentIndex+i];
      if(idx === undefined) break;
    }
    const [front, back] = phrases[idx];
    const div = document.createElement("div");
    div.classList.add("phrase");
    div.dataset.idx = idx;
    div.dataset.state = "hidden"; // hidden -> shown -> counted

    // 左に間違えた回数を表示（0は表示しない）
    const count = mistakeCounts[idx] || 0;
    const countText = count > 0 ? `[${count}] ` : "";

    div.innerHTML = `${countText}<span class="front">${front}</span> <span class="back">${back.toUpperCase()}</span>`;

    div.querySelector(".back").style.visibility = toggleFront.checked ? "visible" : "hidden";

    div.addEventListener("click", ()=>{
      if(div.dataset.state === "hidden"){
        div.querySelector(".back").style.visibility = "visible";
        div.dataset.state = "shown";
      } else if(div.dataset.state === "shown"){
        // 間違いとしてカウントアップ
        mistakeCounts[idx] = (mistakeCounts[idx] || 0) + 1;
        div.dataset.state = "counted";

        div.innerHTML = `[${mistakeCounts[idx]}] <span class="front">${front}</span> <span class="back">${back.toUpperCase()}</span>`;
      }
    });

    questionsDiv.appendChild(div);
  }
  updateFrontVisibility();
  showAnswerBtn.disabled = false;
}

showAnswerBtn.addEventListener("click", ()=>{
  document.querySelectorAll(".phrase .back").forEach(span=>{
    span.style.visibility = "visible";
  });
});

nextBtn.addEventListener("click", ()=>{
  currentIndex += questionsPerPage;
  if(currentIndex >= phrases.length){
    currentIndex = 0;
  }
  displayQuestions();
});

toggleFront.addEventListener("change", updateFrontVisibility);
randomOrderCheckbox.addEventListener("change", ()=>{
  currentIndex = 0;
  displayQuestions();
});
weakModeCheckbox.addEventListener("change", ()=>{
  currentIndex = 0;
  displayQuestions();
});

displayQuestions();
</script>

</body>
</html>
